/*! vtree 2014-04-18 */
(function(){var a;a={},window.modula={"export":function(b,c){return a[b]=c},require:function(b){var c;if(c=a[b])return c;throw"Module '"+b+"' not found."}}}).call(this),function(){var a;a=function(){function a(){}return a.prototype.viewSelector="[data-view]",a.prototype.appPelector="[data-app]",a.prototype.selector="[data-app], [data-view]",a.prototype.componentPattern=/(.+)#(.+)/,a.prototype.isLayout=function(a){return null!=a.data("app")},a.prototype.layoutUnderscoredName=function(a){return a.data("app")},a.prototype.nodeUnderscoredName=function(a){return this.isLayout(a)?"layout":a.data("view")||""},a.prototype.hasComponent=function(a){return this.componentPattern.test(this.nodeUnderscoredName(a))},a.prototype.extractComponentData=function(a){var b,c,d,e;return e=this.nodeUnderscoredName(a).match(this.componentPattern),d=e[0],b=e[1],c=e[2],[b,c]},a}(),modula["export"]("vtree/configuration",a)}.call(this),function(){var a,b;a=modula.require("vtree/configuration"),b=function(){function b(){}return b.initNodes=function(){return this._launcher().launch(),this._launcher().createViewsTree()},b.onNodeInit=function(a){return this.hooks().onInit(a)},b.getInitCallbacks=function(){return this.hooks().onInitCallbacks()},b.onNodeUnload=function(a){return this.hooks().onUnload(a)},b.getUnloadCallbacks=function(){return this.hooks().onUnloadCallbacks()},b.configure=function(a){return _.extend(this.config(),a)},b.config=function(){return this._config=new a},b.hooks=function(){var a;return null!=this._hooks?this._hooks:(a=modula.require("vtree/hooks"),null!=this._hooks?this._hooks:this._hooks=new a)},b._launcher=function(){return null!=this.__launcher?this.__launcher:this.__launcher=modula.require("vtree/launcher")},b}(),modula["export"]("vtree",b),window.Vtree=b}.call(this),function(){var a,b=[].slice;a=function(){function a(){}return a.prototype.onInit=function(a){return this.onInitCallbacks().push(a)},a.prototype.onInitCallbacks=function(){return this._onInitCallbacks||(this._onInitCallbacks=[])},a.prototype.init=function(){var a,c,d,e,f,g;for(a=1<=arguments.length?b.call(arguments,0):[],f=this.onInitCallbacks(),g=[],d=0,e=f.length;e>d;d++)c=f[d],g.push(c.apply(null,a));return g},a.prototype.onActivation=function(a){return this.onActivationCallbacks().push(a)},a.prototype.onActivationCallbacks=function(){return this._onActivationCallbacks||(this._onActivationCallbacks=[])},a.prototype.activate=function(){var a,c,d,e,f,g;for(a=1<=arguments.length?b.call(arguments,0):[],f=this.onActivationCallbacks(),g=[],d=0,e=f.length;e>d;d++)c=f[d],g.push(c.apply(null,a));return g},a.prototype.onUnload=function(a){return this.onUnloadCallbacks().push(a)},a.prototype.onUnloadCallbacks=function(){return this._onUnloadCallbacks||(this._onUnloadCallbacks=[])},a.prototype.unload=function(){var a,c,d,e,f,g;for(a=1<=arguments.length?b.call(arguments,0):[],f=this.onUnloadCallbacks(),g=[],d=0,e=f.length;e>d;d++)c=f[d],g.push(c.apply(null,a));return g},a}(),modula["export"]("vtree/hooks",a)}.call(this),function(){var a;a=function(){function a(a,b){this.nodes=null!=a?a:{},this.rootNodes=null!=b?b:[]}return a.prototype.show=function(){return this.nodes},a.prototype.showRootNodes=function(){return this.rootNodes},a.prototype.add=function(a){return this.nodes[a.id]=a},a.prototype.addAsRoot=function(a){return this.rootNodes.push(a)},a.prototype.getById=function(a){return this.nodes[a]},a.prototype.removeById=function(a){return delete this.nodes[a],this.rootNodes=_.reject(this.rootNodes,function(b){return b.id===a})},a.prototype.clear=function(){return this.nodes={},this.rootNodes=[]},a}(),modula["export"]("vtree/vtree_nodes_cache",a)}.call(this),function(){var a,b;a=modula.require("vtree/hooks"),b=function(){function b(b,d){this.$el=b,this.hooks=d||new a,this.el=this.$el[0],this.id="nodeId"+c,this.parent=null,this.children=[],c++,this.init()}var c;return c=1,b.prototype.setParent=function(a){return this.parent=a},b.prototype.setChildren=function(a){return this.children=_.filter(a,function(a){return function(b){return b.parent&&b.parent.el===a.el}}(this))},b.prototype.removeChild=function(a){return-1!==_.indexOf(this.children,a)?this.children=_.reject(this.children,function(b){return b===a}):void 0},b.prototype.init=function(){return this.hooks.init(this)},b.prototype.activate=function(){return this.isActivated()?void 0:(this.setAsActivated(),this.hooks.activate(this))},b.prototype.remove=function(){return this.isRemoved()?void 0:(this.setAsRemoved(),this.isActivated()?this.unload():void 0)},b.prototype.unload=function(){return this.hooks.unload(this),this.setAsNotActivated()},b.prototype.setAsActivated=function(){return this._isActivated=!0},b.prototype.setAsNotActivated=function(){return this._isActivated=!1},b.prototype.isActivated=function(){return this._isActivated||(this._isActivated=!1)},b.prototype.setAsRemoved=function(){return this._isRemoved=!0},b.prototype.isRemoved=function(){return this._isRemoved||(this._isRemoved=!1)},b}(),modula["export"]("vtree/node",b)}.call(this),function(){var a;a=function(){function a(a){_.extend(this,a),this.data={}}return a.prototype.el=null,a.prototype.$el=null,a.prototype.isApplicationLayout=null,a.prototype.isApplicationPart=null,a.prototype.isComponentPart=null,a.prototype.applicationId=null,a.prototype.nodeName=null,a.prototype.applicationName=null,a.prototype.componentName=null,a.prototype.nodeNameUnderscored=null,a.prototype.applicationNameUnderscored=null,a.prototype.componentNameUnderscored=null,a.prototype.setData=function(a,b){return this.data[a]=b},a.prototype.getData=function(a){return this.data[a]},a}(),modula["export"]("vtree/node_data",a)}.call(this),function(){var a,b,c;c=modula.require("vtree"),a=modula.require("vtree/node_data"),b=function(){function b(a){this.node=a,this.$el=this.node.$el,this.el=this.node.el,this.isLayout()&&f++,this.identifyNodeAttributes(),this.initNodeDataObject()}var d,e,f;return f=0,d=/(.+)#(.+)/,e="semarf",b.prototype.identifyNodeAttributes=function(){var a;return this.layoutName=this.layout().name,this.layoutId=this.layout().id,this.hasComponent()?(a=c.config().extractComponentData(this.$el),this.componentName=a[0],this.nodeName=a[1],a):(this.componentName=this.layoutName,this.nodeName=this.nodeUnderscoredName())},b.prototype.initNodeDataObject=function(){var a;return this.nodeData=this.initNodeData(),null!=(a=this._hooks())&&"function"==typeof a.init?a.init(this.nodeData):void 0},b.prototype.initNodeData=function(){var b,c,d,e;return this.hasComponent()?(e=this.componentName,d=this._camelize(this.componentName),c=null,b=null):(c=this.componentName,b=this._camelize(this.componentName),e=null,d=null),new a({el:this.el,$el:this.$el,isApplicationLayout:this.isLayout(),isApplicationPart:!this.hasComponent(),isComponentPart:this.hasComponent(),applicationId:this.hasComponent()?null:this.layoutId,nodeName:this._camelize(this.nodeName),nodeNameUnderscored:this.nodeName,applicationName:b,applicationNameUnderscored:c,componentName:d,componentNameUnderscored:e})},b.prototype.unload=function(){var a;return null!=(a=this._hooks())&&"function"==typeof a.unload&&a.unload(this.nodeData),delete this.nodeData,delete this.node},b.prototype.hasComponent=function(){return this._hasComponent||(this._hasComponent=c.config().hasComponent(this.$el))},b.prototype.layout=function(){return this._layout||(this._layout=this.isLayout()?{name:this.layoutUnderscoredName(),id:f}:null!=this.node.parent?this.node.parent.nodeWrapper.layout():{name:e,id:0})},b.prototype.isLayout=function(){return null!=this._isLayout?this._isLayout:this._isLayout=c.config().isLayout(this.$el)},b.prototype.layoutUnderscoredName=function(){return null!=this._layoutUnderscoredName?this._layoutUnderscoredName:this._layoutUnderscoredName=c.config().layoutUnderscoredName(this.$el)},b.prototype.nodeUnderscoredName=function(){return null!=this._nodeUnderscoredName?this._nodeUnderscoredName:this._nodeUnderscoredName=c.config().nodeUnderscoredName(this.$el)},b.prototype._hooks=function(){return c.hooks()},b.prototype._camelize=function(a){return a.replace(/(?:^|[-_])(\w)/g,function(a,b){return b?b.toUpperCase():""})},b}(),modula["export"]("vtree/node_wrapper",b)}.call(this),function(){var a,b,c,d,e,f;f=modula.require("vtree"),d=modula.require("vtree/vtree_nodes_cache"),b=modula.require("vtree/node"),c=modula.require("vtree/node_wrapper"),a=modula.require("vtree/hooks"),e=function(){function e(){this.initNodeHooks(),this.initialNodes=[],this.nodesCache=new d}return e.prototype.initNodeHooks=function(){return this.hooks=new a,this.hooks.onInit(_.bind(this.addNodeIdToElData,this)),this.hooks.onInit(_.bind(this.addRemoveEventHandlerToEl,this)),this.hooks.onActivation(_.bind(this.addNodeWrapper,this)),this.hooks.onUnload(_.bind(this.unloadView,this)),this.hooks.onUnload(_.bind(this.deleteNodeWrapper,this))},e.prototype.createTree=function(){return this.setInitialNodes(),this.setParentsForInitialNodes(),this.setChildrenForInitialNodes(),this.activateInitialNodes()},e.prototype.setInitialNodes=function(){var a,c,d,e,g,h;for(a=$(f.config().selector),this.initialNodes=[],h=[],c=e=0,g=a.length;g>=0?g>e:e>g;c=g>=0?++e:--e)d=new b(a.eq(c),this.hooks),this.nodesCache.add(d),h.push(this.initialNodes.push(d));return h},e.prototype.setParentsForInitialNodes=function(){return this.setParentsForNodes(this.initialNodes)},e.prototype.setChildrenForInitialNodes=function(){return this.setChildrenForNodes(this.initialNodes)},e.prototype.setParentsForNodes=function(a){var b,c,d,e,g,h;for(h=[],e=0,g=a.length;g>e;e++)c=a[e],b=c.$el.parent().closest(f.config().selector),0===b.length?h.push(this.nodesCache.addAsRoot(c)):(d=b.data("vtree-node-id"),h.push(c.parent=this.nodesCache.getById(d)));return h},e.prototype.setChildrenForNodes=function(a){var b;if(a.length)return b=a.shift(),b.setChildren(a),this.setChildrenForNodes(a)},e.prototype.activateInitialNodes=function(){return this.activateRootNodes(this.initialNodes)},e.prototype.activateRootNodes=function(){var a,b,c,d,e;for(b=this.nodesCache.showRootNodes(),e=[],c=0,d=b.length;d>c;c++)a=b[c],e.push(this.activateNode(a));return e},e.prototype.activateNode=function(a){var b,c,d,e,f;for(a.activate(),e=a.children,f=[],c=0,d=e.length;d>c;c++)b=e[c],f.push(this.activateNode(b));return f},e.prototype.removeNode=function(a){return a.isRemoved()?void 0:(a.parent&&a.parent.removeChild(a),this.removeChildNodes(a),a.remove(),this.nodesCache.removeById(a.id))},e.prototype.removeChildNodes=function(a){var b,c,d,e,f;for(c=_.clone(a.children),f=[],d=0,e=c.length;e>d;d++)b=c[d],this.removeChildNodes(b),b.remove(),f.push(this.nodesCache.removeById(b.id));return f},e.prototype.refresh=function(a){var c,d,e,g,h,i,j,k;for(d=a.$el.find(f.config().selector),g=[a],e=j=0,k=d.length;k>=0?k>j:j>k;e=k>=0?++j:--j)c=d.eq(e),(i=c.data("vtree-node-id"))?h=this.nodesCache.getById(i):(h=new b(d.eq(e),this.hooks),this.nodesCache.add(h)),g.push(h);return this.setParentsForNodes(g),this.setChildrenForNodes(g),this.activateNode(a)},e.prototype.addNodeIdToElData=function(a){return a.$el.data("vtree-node-id",a.id)},e.prototype.addRemoveEventHandlerToEl=function(a){return a.$el.on("remove",function(b){return function(){return b.removeNode(a)}}(this))},e.prototype.addNodeWrapper=function(a){return a.nodeWrapper=new c(a)},e.prototype.unloadView=function(a){var b;return null!=(b=a.nodeWrapper)&&"function"==typeof b.unload?b.unload():void 0},e.prototype.deleteNodeWrapper=function(a){return delete a.nodeWrapper},e}(),modula["export"]("vtree/tree_manager",e)}.call(this),function(){var a,b,c;c=modula.require("vtree"),b=modula.require("vtree/tree_manager"),a=function(){function a(){}return a.launch=function(){return this.initTreeManager(),this.initRemoveEvent(),this.initRefreshEvent()},a.initTreeManager=function(){return this.isTreeManagerInitialized()?void 0:(this.setTreeManagerAsInitialized(),this.treeManager=new b)},a.initRemoveEvent=function(){return this.isRemoveEventInitialized()?void 0:(this.setRemoveEventAsInitialized(),$.event.special.remove={remove:function(a){var b,c;return c=this,b={type:"remove",data:a.data,currentTarget:c},a.handler(b)}})},a.initRefreshEvent=function(){return this.isRefreshEventInitialized()?void 0:(this.setRefreshEventAsInitialized(),$("body").on("refresh","*",function(a){return function(b){var d,e,f;for(b.stopPropagation(),d=$(b.currentTarget).closest(c.config().selector),f=d.data("vtree-node-id");d.length&&!f;)d=d.parent().closest(c.config().selector),f=d.data("vtree-node-id");return f?(e=a.treeManager.nodesCache.getById(f),a.treeManager.refresh(e)):void 0}}(this)))},a.createViewsTree=function(){return this.treeManager.createTree()},a.isTreeManagerInitialized=function(){return this._isTreeManagerInitialized||(this._isTreeManagerInitialized=!1)},a.setTreeManagerAsInitialized=function(){return this._isTreeManagerInitialized=!0},a.isRemoveEventInitialized=function(){return this._isRemoveEventInitialized||(this._isRemoveEventInitialized=!1)},a.setRemoveEventAsInitialized=function(){return this._isRemoveEventInitialized=!0},a.isRefreshEventInitialized=function(){return this._isRefreshEventInitialized||(this._isRefreshEventInitialized=!1)},a.setRefreshEventAsInitialized=function(){return this._isRefreshEventInitialized=!0},a}(),modula["export"]("vtree/launcher",a)}.call(this),function(){var a;a=function(){function a(){}return a.html=function(a,b){return a.html(b),a.trigger("refresh")},a.append=function(a,b){return a.append(b),a.trigger("refresh")},a.prepend=function(a,b){return a.prepend(b),a.trigger("refresh")},a.before=function(a,b){return a[0]!==document.body?(a.before(b),a.parent().trigger("refresh")):void 0},a.after=function(a,b){return a[0]!==document.body?(a.after(b),a.parent().trigger("refresh")):void 0},a.remove=function(a){return a.remove()},a}(),modula["export"]("vtree/dom",a),window.Vtree.DOM=a}.call(this);